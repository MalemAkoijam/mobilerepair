{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tool Activation Payment Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    body {
      background-color: #f8f9fa;
      font-family: 'Segoe UI', sans-serif;
    }
    .table thead th,
    .table tbody td {
      vertical-align: middle;
    }
    .form-select, .form-control {
      font-size: 0.9rem;
    }
    .btn-outline-primary, .btn-outline-success {
      transition: all 0.3s ease;
    }
    .btn-outline-primary:hover, .btn-outline-success:hover {
      transform: translateY(-1px);
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    }
  </style>
</head>
<body>
  <div class="container-fluid mt-4">
    <h2 class="mb-4 fw-bold text-success">ğŸ’³ Tool Activation Payment History</h2>
    {% if payments %}
    <div class="table-responsive">
      <table class="table table-bordered table-hover shadow-sm rounded">
        <thead class="table-success">
          <tr>
            <th>User</th>
            <th>Tool</th>
            <th>Plan</th>
            <th>Price</th>
            <th>Paid At</th>
            <th>Status</th>
            <th>Update</th>
          </tr>
        </thead>
        <tbody>
          {% for payment in payments %}
          <tr>
            <td>{{ payment.user_name }}</td>
            <td>{{ payment.tool.name }}</td>
            <td>{{ payment.month }} Month(s)</td>
            <td>â‚¹{{ payment.amount }}</td>
            <td>
              {% if payment.payment_time %}
                {{ payment.payment_time|date:"d M Y, H:i A" }}
              {% else %}
                <em class="text-muted">Not available</em>
              {% endif %}
            </td>
            <td>
              {% if payment.status == 'pending' %}
                <span class="badge bg-warning text-dark">ğŸ”„ Pending</span>
              {% elif payment.status == 'done' %}
                <span class="badge bg-success">âœ… Done</span>
              {% elif payment.status == 'rejected' %}
                <span class="badge bg-danger">âŒ Rejected</span>
              {% else %}
                <span class="badge bg-secondary">âŒ› Unknown</span>
              {% endif %}
            </td>
            <td>
              <form method="POST" action="{% url 'update_payment_status' payment.id %}">
                {% csrf_token %}
                <select name="status" class="form-select form-select-sm mb-1">
                  <option value="pending" {% if payment.status == 'pending' %}selected{% endif %}>ğŸ”„ Pending</option>
                  <option value="done" {% if payment.status == 'done' %}selected{% endif %}>âœ… Done</option>
                  <option value="rejected" {% if payment.status == 'rejected' %}selected{% endif %}>âŒ Rejected</option>
                </select>
                <textarea name="message" rows="2" class="form-control form-control-sm mb-1" placeholder="Message">{{ payment.message }}</textarea>
                <button type="submit" class="btn btn-sm btn-outline-success w-100">Update</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <div class="alert alert-info">No tool activation payment records found.</div>
    {% endif %}

    <nav class="mt-3">
      <ul class="pagination">
        {% if payments.has_previous %}
          <li class="page-item"><a class="page-link" href="?q={{ query }}&payment_page={{ payments.previous_page_number }}">Previous</a></li>
        {% endif %}
        <li class="page-item disabled"><a class="page-link">Page {{ payments.number }} of {{ payments.paginator.num_pages }}</a></li>
        {% if payments.has_next %}
          <li class="page-item"><a class="page-link" href="?q={{ query }}&payment_page={{ payments.next_page_number }}">Next</a></li>
        {% endif %}
      </ul>
    </nav>
  </div>
</body>
</html>
