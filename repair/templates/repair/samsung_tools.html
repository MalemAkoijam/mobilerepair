{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Samsung FRP IMEI History & Payment Confirmations</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap & Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

  <!-- Custom Styling -->
  <style>
    body {
      background: #f1f3f9;
      font-family: 'Segoe UI', sans-serif;
    }

    .content-wrapper {
      flex-grow: 1;
    }

    table {
      background: white;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
      overflow: hidden;
      animation: fadeIn 0.6s ease;
    }

    thead {
      background-color: #0d6efd;
      color: white;
    }

    .badge-processing {
      background-color: #ffc107;
    }

    .badge-done {
      background-color: #28a745;
    }

    .badge-reject {
      background-color: #dc3545;
    }

    @keyframes fadeIn {
      0% { opacity: 0; transform: translateY(20px); }
      100% { opacity: 1; transform: translateY(0); }
    }

    #searchInput {
      border-radius: 50px;
      padding: 10px 20px;
      border: 1px solid #ced4da;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      margin-bottom: 30px;
    }

    .fade-in {
      animation: fadeIn 0.5s ease-in-out;
    }
    table.table-sm th,
    table.table-sm td {
      font-size: 0.75rem;
      padding: 0.3rem 0.4rem;
    }

    @media (max-width: 768px) {
      table {
        font-size: 0.72rem;
      }

      td, th {
        white-space: normal !important;
        word-break: break-word;
      }
    }

  </style>
</head>
<body class="d-flex flex-column min-vh-100">
  {% include "repair/header.html" %}
  <div class="container-fluid content-wrapper py-2">
    <!-- Samsung FRP IMEI History -->
    <h2 class="mb-4 text-primary">📋 Samsung FRP IMEI Order History</h2>

    {% if messages %}
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      {% endfor %}
    {% endif %}
    <!-- 🔍 Unified Search Form -->
    <form method="get" class="mb-4 d-flex">
      <input type="text" name="q" class="form-control me-2" placeholder="🔍 Search Orders or Payments..." value="{{ query }}">
      <button type="submit" class="btn btn-outline-primary">Search</button>
    </form>


    {% if orders %}
      <div class="table-responsive mt-3">
        <table class="table table-striped align-middle" id="orderTable">


          <thead>
            <tr>
              <th>#Order ID</th>
              <th>Status</th>
              <th>You Submitted</th>
              <th>Result</th>
            </tr>
          </thead>
          <tbody>
            {% for order in orders %}
              <tr class="fade-in">
                <td><strong>{{ order.custom_id }}</strong></td>
                <td>
                  <strong>📱 Model:</strong> {{ order.model }}<br>
                  <strong>🔢 IMEI:</strong> {{ order.imei }}
                </td>
                <td>
                  {% if order.status == 'processing' %}
                    <span class="badge badge-processing">🔄 Processing</span>
                  {% elif order.status == 'done' %}
                    <span class="badge badge-done">✅ Done</span>
                  {% elif order.status == 'rejected' %}
                    <span class="badge badge-reject">❌ Rejected</span>
                  {% endif %}
                </td>
                <td>
                  {% if order.status in 'done rejected' %}
                    {{ order.result }}
                  {% else %}
                    <em class="text-muted">Pending...</em>
                  {% endif %}
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <div class="alert alert-info mt-4">No orders submitted yet.</div>
    {% endif %}

  <!-- Pagination for orders -->
  <nav aria-label="Orders pagination">
    <ul class="pagination justify-content-end mt-3">
      {% if orders.has_previous %}
        <li class="page-item">
          <a class="page-link" href="?order_page={{ orders.previous_page_number }}&payment_page={{ payments.number }}">Previous</a>
        </li>
      {% endif %}
      <li class="page-item disabled">
        <span class="page-link">Page {{ orders.number }} of {{ orders.paginator.num_pages }}</span>
      </li>
      {% if orders.has_next %}
        <li class="page-item">
          <a class="page-link" href="?order_page={{ orders.next_page_number }}&payment_page={{ payments.number }}">Next</a>
        </li>
      {% endif %}
    </ul>
  </nav>



    <!-- 🧾 Tool Activation Payment History -->
    <h2 class="mt-2 mb-4 text-success">💳 Tool Activation Payment History</h2>
    {% if payments %}
      <div class="table-responsive">
        <table class="table table-striped align-middle">
          <thead>
            <tr>
              <th>Tool</th>
              <th>Plan</th>
              <th>Price</th>
              <th>Paid At</th>
              <th>Status</th>
              <th>Status / Messages</th>
            </tr>
          </thead>
          <tbody>
            {% for payment in payments %}
              <tr class="fade-in">
                <td><strong>{{ payment.tool.name }}</strong></td>
                <td>{{ payment.month }} Month(s)</td>
                <td>₹{{ payment.amount }}</td>
                <td>
                  {% if payment.payment_time %}
                    {{ payment.payment_time|date:"d M Y, H:i A" }}
                  {% else %}
                    <em class="text-muted">Not available</em>
                  {% endif %}
                </td>
                 <td>
                  {% if payment.status == 'pending' %}
                    <span class="badge bg-warning text-dark">🔄 Pending</span>
                  {% elif payment.status == 'done' %}
                    <span class="badge bg-success">✅ Done</span>
                  {% elif payment.status == 'rejected' %}
                    <span class="badge bg-danger">❌ Rejected</span>
                  {% else %}
                    <span class="badge bg-secondary">⌛ Unknown</span>
                  {% endif %}
                </td>
                <td>{{ payment.message }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <div class="alert alert-info">No payment confirmations found.</div>
    {% endif %}
      <!-- Pagination for payments -->
  <nav aria-label="Payments pagination">
    <ul class="pagination justify-content-end mt-3">
      {% if payments.has_previous %}
        <li class="page-item">
          <a class="page-link" href="?payment_page={{ payments.previous_page_number }}&order_page={{ orders.number }}">Previous</a>
        </li>
      {% endif %}
      <li class="page-item disabled">
        <span class="page-link">Page {{ payments.number }} of {{ payments.paginator.num_pages }}</span>
      </li>
      {% if payments.has_next %}
        <li class="page-item">
          <a class="page-link" href="?payment_page={{ payments.next_page_number }}&order_page={{ orders.number }}">Next</a>
        </li>
      {% endif %}
    </ul>
  </nav>
  </div>
  <div class="container-fluid mt-2">
   <div class="container-fluid d-flex justify-content-between align-items-center mb-4">
      <h3 class="mb-0 text-primary">📋 Your IMEI Order History</h3>
      <a href="{% url 'imei_order_view' %}" class="btn btn-outline-primary">
        <i class="bi bi-plus-circle me-1"></i> Place New Order
      </a>
    </div>

    {% if orders %}
      <div class="table-responsive">
        <table class="table table-striped">
          <thead>
            <tr>
              <th>Service</th>
              <th>Serial Numbers</th>
              <th>Price</th>
              <th>Frequent</th>
              <th>Date</th>
              <th>Status</th>
              <th>Results</th>
            </tr>
          </thead>
          <tbody>
            {% for order_imei in orders_imei %}
            <tr>
              <td>{{ order_imei.service_name }}</td>
              <td>{{ order_imei.serial_numbers|linebreaksbr }}</td>
              <td>₹{{ order_imei.service_price }}</td>
              <td>
                {% if order_imei.frequent_use %}
                  ✅
                {% else %}
                  ❌
                {% endif %}
              </td>
               <td>{{ order_imei.created_at|date:"d M Y H:i" }}</td>
              <td>
                {% if order_imei.status == 'done' %}
                  <span class="badge bg-success">✅ Done</span>
                {% elif order_imei.status == 'rejected' %}
                  <span class="badge bg-danger">❌ Rejected</span>
                {% elif order_imei.status == 'processing' %}
                  <span class="badge bg-primary">🔄 Processing</span>
                {% else %}
                  <span class="badge bg-secondary">❓ Unknown</span>
                {% endif %}
              </td>

               <td>{{ order_imei.remarks}}</td>

            </tr>

            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <p class="text-muted">You have not placed any orders yet.</p>
    {% endif %}

  </div>




  {% include "repair/footer.html" %}

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      setInterval(() => {
        location.reload();
      }, 10000); // 10 seconds
    });
  </script>
</body>
</html>
